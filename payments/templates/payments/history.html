{% extends 'payments/base.html' %}

{% block content %}
<h2 class="fw-bold mb-4 text-center">Transaction Dashboard</h2>

<!-- Chart Section -->
<div class="card shadow border-0 mb-4 p-3">
  <h5 class="fw-semibold mb-3">ğŸ“Š Payment Analytics</h5>
  <canvas id="paymentsChart"></canvas>
</div>

<!-- Transactions Table -->
<div class="card shadow border-0 p-3">
  <h5 class="fw-semibold mb-3">ğŸ“œ Transaction History</h5>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Merchant</th>
          <th>Amount (â‚¹)</th>
          <th>Date & Time</th>
        </tr>
      </thead>
      <tbody>
        {% for t in txns %}
        <tr>
          <td>ğŸª {{ t.merchant.store_name }}</td>
          <td class="fw-bold text-success">â‚¹{{ t.amount }}</td>
          <td class="text-muted">{{ t.created_at }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-center text-muted">No transactions yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const labels = [
    {% for t in txns %}
      "{{ t.merchant.store_name }}",
    {% endfor %}
  ];

  const data = [
    {% for t in txns %}
      {{ t.amount }},
    {% endfor %}
  ];

  const ctx = document.getElementById('paymentsChart');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Payments (â‚¹)',
        data: data,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}

